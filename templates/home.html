<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>Projet2 - Images</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>

    <header>
        <h1>Galerie</h1>
    </header>

    <div class="layout">

        <!-- MENU GAUCHE -->
        <aside class="sidebar">
            <h2>Réglages</h2>

            {% if folders %}
            <form method="GET" action="/">

                <!-- Choix du dossier -->
                <label for="folder">Dossier</label>
                <select id="folder" name="folder" onchange="this.form.submit()">
                    {% for f in folders %}
                    <option value="{{ f }}" {% if f==folder %}selected{% endif %}>
                        {{ f }}
                    </option>
                    {% endfor %}
                </select>

                <!-- Choix image -->
                <label for="img" style="margin-top: 1rem;">Image</label>
                <select id="img" name="img">
                    {% for img in images %}
                    <option value="{{ img }}" {% if img==selected %}selected{% endif %}>
                        {{ img }}
                    </option>
                    {% endfor %}
                </select>

                <!-- Choix algorithme -->
                <label for="algo" style="margin-top: 1rem;">Algorithme</label>
                <select id="algo" name="algo">
                    <option value="original" {% if algo=="original" %}selected{% endif %}>
                        Original
                    </option>
                    <option value="kmeans" {% if algo=="kmeans" %}selected{% endif %}>
                        KMeans (couleurs)
                    </option>
                    <option value="hclust" {% if algo=="hclust" %}selected{% endif %}>
                        HClust (hiérarchique)
                    </option>
                    <option value="dbscan" {% if algo=="dbscan" %}selected{% endif %}>
                        DBSCAN (densité)
                    </option>
                </select>

                <!-- Paramètres K (KMeans / HClust) -->
                <div id="k_block">
                    <label for="k" style="margin-top: 1rem;">Nombre K</label>
                    <input type="number" id="k" name="k" min="2" max="32" value="{{ k }}">
                </div>

                <!-- Paramètres DBSCAN -->
                <div id="dbscan_block">
                    <label for="min_samples" style="margin-top: 1rem;">min_samples (DBSCAN)</label>
                    <input type="number" id="min_samples" name="min_samples" min="2" max="64" value="{{ min_samples }}">

                    <label for="eps" style="margin-top: 1rem;">eps (DBSCAN)</label>
                    <input type="number" id="eps" name="eps" step="0.1" value="{{ eps }}">

                    <!-- AJOUT : choix d'une seule classe -->
                    <label for="selected_class" style="margin-top: 1rem;">Afficher une seule classe</label>
                    <select id="selected_class" name="selected_class">
                        <option value="" {% if selected_class is none %}selected{% endif %}>Toutes</option>
                        {% if classes %}
                        {% for c in classes %}
                        <option value="{{ c }}" {% if selected_class==c %}selected{% endif %}>
                            Classe {{ c }}
                        </option>
                        {% endfor %}
                        {% endif %}
                    </select>
                </div>

                <button type="submit" style="margin-top: 1rem;">
                    Appliquer
                </button>

            </form>
            {% else %}
            <p class="muted">Aucun dossier trouvé.</p>
            {% endif %}

        </aside>

        <!-- AFFICHAGE IMAGE -->
        <main class="content">
            <h2>Affichage</h2>

            {% if display_image and folder %}
            <div class="viewer">
                <img src="{{ url_for('photo') }}?folder={{ folder }}&img={{ display_image }}" alt="Image sélectionnée">

                <p class="caption">
                    {{ selected }}
                    — <strong>{{ algo }}</strong>
                    {% if algo == "kmeans" %} (K={{ k }}){% endif %}
                    {% if algo == "hclust" %} (K={{ k }}){% endif %}
                    {% if algo == "dbscan" %}
                    (min_samples={{ min_samples }},
                    eps={{ eps }},
                    K trouvé={{ n_clusters }},
                    classes={{ classes }},
                    bruit={{ n_noise }}
                    {% if selected_class is not none %}, classe affichée={{ selected_class }}{% endif %})
                    {% endif %}
                </p>
            </div>
            {% else %}
            <p class="muted">Aucune image à afficher.</p>
            {% endif %}

        </main>

    </div>

    <script>
        function updateParamsVisibility() {
            const algo = document.getElementById("algo").value;

            const kBlock = document.getElementById("k_block");
            const dbscanBlock = document.getElementById("dbscan_block");

            if (algo === "dbscan") {
                kBlock.style.display = "none";
                dbscanBlock.style.display = "block";
            } else {
                kBlock.style.display = "block";
                dbscanBlock.style.display = "none";
            }
        }

        document.getElementById("algo").addEventListener("change", updateParamsVisibility);
        window.addEventListener("load", updateParamsVisibility);
    </script>

</body>

</html>